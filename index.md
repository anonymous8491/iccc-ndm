<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

<script type="text/javascript"> 
      // Show button
      function look(type){ 
      param=document.getElementById(type); 
      if(param.style.display == "none") param.style.display = "block"; 
      else param.style.display = "none" 
      } 
</script> 

# The Neural Drum Machine

This repository describes the additional material and experiments around the paper ["Neural Drum Machine"](paper.pdf) submitted at the 2019 International Conference on Computational Creativity.

In this work, we introduce an audio synthesis architecture for real-time generation of drum sounds. The generative model is based on a conditional convolutional Wasserstein autoencoder (WAE) that learns to generate Mel-scaled magnitude spectrograms of short percussion samples. A Multi-Head Convolutional Neural Network implicitly performs phase reconstruction (MCNN) by estimating the audio signal directly from the magnitude spectrogram. The system is trained on a dataset of drum sounds containing 11 categories. In the end, it is capable of synthesizing sounds in real-time on a CPU. Furthermore, we describe a Max/MSP-based interface designed to interact with the model. With this setup, the system can be easily integrated into a studio-production environment. Moreover, the interface provides simple control over the sound generation process, which allows the user to quickly explore the space of possible drum timbres.

<div align="center" style="font-size:75%;">
<img src="https://anonymous9123.github.io/iccc-ndm/figures/NDM.png">
Our system's global architecture. The generative model (1) learns how to reconstruct spectrograms from a parameters’ space. Then, the second part of the system (2) is dedicated to spectrogram inversion, to generate some signal from a Mel spectrogram. Finally, the software interface (3) allows a user to interact with the model and to generate sound from the parameters’ space.
</div>

<br>

Here, we directly embed the exposed elements
  * [Reconstruction results for all parts of our model](#reconstructions-results)
  * [Audio generated by sampling the latent space](#audio-generations)
  * [Video demonstration of our plugin in Ableton Live](#video-demonstration)
  
## Reconstruction Results
<table>
<caption><b> Bongo </b></caption>
  <tr>
    <td style="text-align: center; vertical-align: middle;"><b>Input</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>WAE Output</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>Output</b></td>
  </tr>
  
  <tr>
    <td style="text-align: center; vertical-align: middle;">
      <audio controls>
      <source src="https://anonymous9123.github.io/iccc-ndm/sounds/rec/bongo.wav">
      </audio>
    </td>
    <td> </td>
    <td style="text-align: center; vertical-align: middle;">
      <audio controls>
      <source src="https://anonymous9123.github.io/iccc-ndm/sounds/rec/bongor.wav">
      </audio>
    </td>
  </tr>
  
  <tr>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/bongoin.png"></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/bongoWAE.png"></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/bongoout.png"></td>
  </tr>
  <tr>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/bongowin.png"></td>
    <td></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/bongowout.png"></td>
  </tr>
</table>

<table>
<caption><b> Kick </b></caption>
  <tr>
    <td style="text-align: center; vertical-align: middle;"><b>Input</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>WAE Output</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>Output</b></td>
  </tr>
  
  <tr>
    <td style="text-align: center; vertical-align: middle;">
      <audio controls>
      <source src="https://anonymous9123.github.io/iccc-ndm/sounds/rec/ki.wav">
      </audio>
    </td>
    <td> </td>
    <td style="text-align: center; vertical-align: middle;">
      <audio controls>
      <source src="https://anonymous9123.github.io/iccc-ndm/sounds/rec/kir.wav">
      </audio>
    </td>
  </tr>
  
  <tr>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/kiin.png"></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/kiWAE.png"></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/kiout.png"></td>
  </tr>
  <tr>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/kiwin.png"></td>
    <td></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/kiwout.png"></td>
  </tr>
</table>

<b>Click here if you want to <a href="javascript:look('divRec');" title="More reconstructions"> see more reconstruction results ... </a></b>
<div id="divRec" style="display: none;">

<table>
<caption><b> Open Hihat </b></caption>
  <tr>
    <td style="text-align: center; vertical-align: middle;"><b>Input</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>WAE Output</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>Output</b></td>
  </tr>
  
  <tr>
    <td style="text-align: center; vertical-align: middle;">
      <audio controls>
      <source src="https://anonymous9123.github.io/iccc-ndm/sounds/rec/ohh.wav">
      </audio>
    </td>
    <td> </td>
    <td style="text-align: center; vertical-align: middle;">
      <audio controls>
      <source src="https://anonymous9123.github.io/iccc-ndm/sounds/rec/ohhr.wav">
      </audio>
    </td>
  </tr>
  
  <tr>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/ohhin.png"></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/ohhWAE.png"></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/ohhout.png"></td>
  </tr>
  <tr>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/ohhwin.png"></td>
    <td></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/ohhwout.png"></td>
  </tr>
</table>


<table>
<caption><b> Closed Hihat </b></caption>
  <tr>
    <td style="text-align: center; vertical-align: middle;"><b>Input</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>WAE Output</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>Output</b></td>
  </tr>
  
  <tr>
    <td style="text-align: center; vertical-align: middle;">
      <audio controls>
      <source src="https://anonymous9123.github.io/iccc-ndm/sounds/rec/chh.wav">
      </audio>
    </td>
    <td> </td>
    <td style="text-align: center; vertical-align: middle;">
      <audio controls>
      <source src="https://anonymous9123.github.io/iccc-ndm/sounds/rec/chhr.wav">
      </audio>
    </td>
  </tr>
  
  <tr>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/chhin.png"></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/chhWAE.png"></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/chhout.png"></td>
  </tr>
  <tr>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/chhwin.png"></td>
    <td></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/chhwout.png"></td>
  </tr>
</table>


<table>
<caption><b> Tom </b></caption>
  <tr>
    <td style="text-align: center; vertical-align: middle;"><b>Input</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>WAE Output</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>Output</b></td>
  </tr>
  
  <tr>
    <td style="text-align: center; vertical-align: middle;">
      <audio controls>
      <source src="https://anonymous9123.github.io/iccc-ndm/sounds/rec/tom.wav">
      </audio>
    </td>
    <td> </td>
    <td style="text-align: center; vertical-align: middle;">
      <audio controls>
      <source src="https://anonymous9123.github.io/iccc-ndm/sounds/rec/tomr.wav">
      </audio>
    </td>
  </tr>
  
  <tr>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/tomin.png"></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/tomWAE.png"></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/tomout.png"></td>
  </tr>
  <tr>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/tomwin.png"></td>
    <td></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/tomwout.png"></td>
  </tr>
</table>

<table>
<caption><b> Conga </b></caption>
  <tr>
    <td style="text-align: center; vertical-align: middle;"><b>Input</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>WAE Output</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>Output</b></td>
  </tr>
  
  <tr>
    <td style="text-align: center; vertical-align: middle;">
      <audio controls>
      <source src="https://anonymous9123.github.io/iccc-ndm/sounds/rec/conga.wav">
      </audio>
    </td>
    <td> </td>
    <td style="text-align: center; vertical-align: middle;">
      <audio controls>
      <source src="https://anonymous9123.github.io/iccc-ndm/sounds/rec/congar.wav">
      </audio>
    </td>
  </tr>
  
  <tr>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/cgin.png"></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/cgWAE.png"></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/cgout.png"></td>
  </tr>
  <tr>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/cgwin.png"></td>
    <td></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/cgwout.png"></td>
  </tr>
</table>

<table>
<caption><b> Clap </b></caption>
  <tr>
    <td style="text-align: center; vertical-align: middle;"><b>Input</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>WAE Output</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>Output</b></td>
  </tr>
  
  <tr>
    <td style="text-align: center; vertical-align: middle;">
      <audio controls>
      <source src="https://anonymous9123.github.io/iccc-ndm/sounds/rec/clap.wav">
      </audio>
    </td>
    <td> </td>
    <td style="text-align: center; vertical-align: middle;">
      <audio controls>
      <source src="https://anonymous9123.github.io/iccc-ndm/sounds/rec/clapr.wav">
      </audio>
    </td>
  </tr>
  
  <tr>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/clapin.png"></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/clapWAE.png"></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/clapout.png"></td>
  </tr>
  <tr>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/clapwin.png"></td>
    <td></td>
    <td><img class="recimg" src="https://anonymous9123.github.io/iccc-ndm/figures/rec/clapwout.png"></td>
  </tr>
</table>


</div>
  
  
## Audio Generations

Here, we present results of audio generations from the latent space. We sample a 64-dimensional Gaussian and give this latent code $$z$$ to our decoder, along with a class label $$c$$. This is supposed to allow us to generate a sound corresponding to that class label. However, listening to the obtained samples, we can say that this conditioning mechanism is not strong enough. Indeed, some samples that were generated from the class label corresponding to kicks actually sound like hihats. Therefore, generating samples by sampling the prior seems not to be the good way to do.

<table>
  <tr>
    <td style="text-align: center; vertical-align: middle;"><b>Class</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>Sample 1</b></td>
    <td style="text-align: center; vertical-align: middle;"><b>Sample 2</b></td>
  </tr>

  <tr>
    <td>Kick</td>
    <td><audio controls><source src="https://anonymous9123.github.io/iccc-ndm/sounds/gen/kick1.wav"></audio></td>
    <td><audio controls><source src="https://anonymous9123.github.io/iccc-ndm/sounds/gen/kick2.wav"></audio></td>
  </tr>
  
  <tr>
    <td>Snare</td>
    <td><audio controls><source src="https://anonymous9123.github.io/iccc-ndm/sounds/gen/snare1.wav"></audio></td>
    <td><audio controls><source src="https://anonymous9123.github.io/iccc-ndm/sounds/gen/snare2.wav"></audio></td>
  </tr>
  
  <tr>
    <td>Closed Hihat</td>
    <td><audio controls><source src="https://anonymous9123.github.io/iccc-ndm/sounds/gen/chh1.wav"></audio></td>
    <td><audio controls><source src="https://anonymous9123.github.io/iccc-ndm/sounds/gen/chh2.wav"></audio></td>
  </tr>
  <tr>
    <td>Bongo</td>
    <td><audio controls><source src="https://anonymous9123.github.io/iccc-ndm/sounds/gen/bg1.wav"></audio></td>
    <td><audio controls><source src="https://anonymous9123.github.io/iccc-ndm/sounds/gen/bg2.wav"></audio></td>
  </tr>
</table>
  
## Video Demonstration
  Here, we showcase our plugin in a studio production environment.
  
  To overcome the problem with conditioning we discussed earlier, we decided to use a Principal Components Analysis (PCA) which aim is to find the 3 most influential dimensions for each category of sound. We denote the PCA dimensions $$P_1$$, $$P_2$$ and $$P_3$$.
  
  To generate sound through the interface, we provide controllers: First, the XY pad allows to control $$P_1$$ and $$P_2$$ and the 'Fine' knob provides control over $$P_3$$. Also, a selector allows the user to define the range of both the pad and the knob. Then, a menu allows the user to set a value for $c$ which comes down to selecting the type of sounds one wants to generate. Finally, we can use the waveform visualizer to crop out remaining artifacts for example.
  
  As you can see, the latency is very low and the conditioning through PCA helps a lot to restrict the generation to a given type of sound.
  
<video id="flatness" class="video-js vjs-default-skin" controls preload="auto" width="600" height="288" data-setup="{}">
<source src="https://anonymous9123.github.io/iccc-ndm/demo.mp4" type='video/mp4'>
</video>
  
